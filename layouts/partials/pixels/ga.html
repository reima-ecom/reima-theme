{{ with site.Data.pixels }}
{{ if .ga_enabled }}

<!-- Global site tag (gtag.js) - Google Analytics -->
<script uses-cookies async src="https://www.googletagmanager.com/gtag/js?id={{.ga_property}}"></script>
<script uses-cookies>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
{{ with .ga_autolink }}
  gtag('set', 'linker', { domains: ['{{.}}'] });
{{ end }}
  gtag('js', new Date());

{{ with .ga_property }}
  gtag('config', '{{.}}');
{{ end }}

{{ with .aw_property }}
  gtag('config', '{{.}}');
{{ end }}
</script>

<!-- product view enhanced ecommerce event -->
{{ with partial "helpers/get-product" $ }}
<script uses-cookies>
  gtag('event', 'view_item', {
    items: [{
      id: "{{$.File.ContentBaseName}}",
      name: "{{.Title}}",
      price: {{.Params.price }},
      quantity: 1,
    }]
  });
</script>
{{ end }}

<!-- add to cart enhanced ecommerce event -->
{{ if partial "helpers/has-product" $ }}
<script uses-cookies>
  document.addEventListener('cart-add', (e) => {
    const checkout = e.detail.checkout;
    const variant = e.detail.variant;

    gtag('event', 'add_to_cart', {
      items: [{
        id: variant.productHandle,
        name: variant.productTitle,
        price: variant.price,
        variant: variant.title,
        quantity: 1,
      }]
    });
  });
</script>
{{ end }}

{{ end }}
{{ end }}
